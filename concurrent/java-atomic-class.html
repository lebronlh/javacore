<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java åŸå­å˜é‡ç±» | JAVACORE</title>
    <meta name="generator" content="VuePress 1.6.0">
    <link rel="icon" href="/javacore/favicon.ico">
    <meta name="description" content="Java æ•™ç¨‹">
    <link rel="preload" href="/javacore/assets/css/0.styles.f91e4221.css" as="style"><link rel="preload" href="/javacore/assets/js/app.2a3d1b81.js" as="script"><link rel="preload" href="/javacore/assets/js/4.c74b6b46.js" as="script"><link rel="preload" href="/javacore/assets/js/33.06f835e3.js" as="script"><link rel="preload" href="/javacore/assets/js/5.0833ef28.js" as="script"><link rel="prefetch" href="/javacore/assets/js/10.0dd85839.js"><link rel="prefetch" href="/javacore/assets/js/11.72445ae5.js"><link rel="prefetch" href="/javacore/assets/js/12.f279426d.js"><link rel="prefetch" href="/javacore/assets/js/13.2680dd0e.js"><link rel="prefetch" href="/javacore/assets/js/14.dadba34d.js"><link rel="prefetch" href="/javacore/assets/js/15.5008c79a.js"><link rel="prefetch" href="/javacore/assets/js/16.1140783f.js"><link rel="prefetch" href="/javacore/assets/js/17.055499c0.js"><link rel="prefetch" href="/javacore/assets/js/18.8cdcc4ae.js"><link rel="prefetch" href="/javacore/assets/js/19.b6a9daaa.js"><link rel="prefetch" href="/javacore/assets/js/20.709249a9.js"><link rel="prefetch" href="/javacore/assets/js/21.b90e5b99.js"><link rel="prefetch" href="/javacore/assets/js/22.ea38045a.js"><link rel="prefetch" href="/javacore/assets/js/23.9080d5b2.js"><link rel="prefetch" href="/javacore/assets/js/24.aae78e92.js"><link rel="prefetch" href="/javacore/assets/js/25.d6772619.js"><link rel="prefetch" href="/javacore/assets/js/26.0b47d817.js"><link rel="prefetch" href="/javacore/assets/js/27.2303dbef.js"><link rel="prefetch" href="/javacore/assets/js/28.e1f6159a.js"><link rel="prefetch" href="/javacore/assets/js/29.982548b2.js"><link rel="prefetch" href="/javacore/assets/js/30.a5c100a6.js"><link rel="prefetch" href="/javacore/assets/js/31.03394049.js"><link rel="prefetch" href="/javacore/assets/js/32.623b2691.js"><link rel="prefetch" href="/javacore/assets/js/34.9e3fdda7.js"><link rel="prefetch" href="/javacore/assets/js/35.3028000e.js"><link rel="prefetch" href="/javacore/assets/js/36.b83f2210.js"><link rel="prefetch" href="/javacore/assets/js/37.f5ec7c64.js"><link rel="prefetch" href="/javacore/assets/js/38.5255d2fb.js"><link rel="prefetch" href="/javacore/assets/js/39.0a05692c.js"><link rel="prefetch" href="/javacore/assets/js/40.d6c680c8.js"><link rel="prefetch" href="/javacore/assets/js/41.8edbf79d.js"><link rel="prefetch" href="/javacore/assets/js/42.670bbfd6.js"><link rel="prefetch" href="/javacore/assets/js/43.11a04cb7.js"><link rel="prefetch" href="/javacore/assets/js/44.8925e782.js"><link rel="prefetch" href="/javacore/assets/js/45.7daaccf6.js"><link rel="prefetch" href="/javacore/assets/js/46.c0674db3.js"><link rel="prefetch" href="/javacore/assets/js/47.e6b38a49.js"><link rel="prefetch" href="/javacore/assets/js/48.a929e2df.js"><link rel="prefetch" href="/javacore/assets/js/49.86053088.js"><link rel="prefetch" href="/javacore/assets/js/50.c72c04c2.js"><link rel="prefetch" href="/javacore/assets/js/51.27bab1d2.js"><link rel="prefetch" href="/javacore/assets/js/52.9cf0449f.js"><link rel="prefetch" href="/javacore/assets/js/53.b2239e56.js"><link rel="prefetch" href="/javacore/assets/js/54.cf32b030.js"><link rel="prefetch" href="/javacore/assets/js/55.d6262571.js"><link rel="prefetch" href="/javacore/assets/js/56.b240db17.js"><link rel="prefetch" href="/javacore/assets/js/57.3a874646.js"><link rel="prefetch" href="/javacore/assets/js/58.3e09c84c.js"><link rel="prefetch" href="/javacore/assets/js/59.eae06560.js"><link rel="prefetch" href="/javacore/assets/js/6.5e436a30.js"><link rel="prefetch" href="/javacore/assets/js/60.77cd5128.js"><link rel="prefetch" href="/javacore/assets/js/61.02a283d2.js"><link rel="prefetch" href="/javacore/assets/js/62.e25d5941.js"><link rel="prefetch" href="/javacore/assets/js/63.dbd89409.js"><link rel="prefetch" href="/javacore/assets/js/64.d989d837.js"><link rel="prefetch" href="/javacore/assets/js/65.62c546b7.js"><link rel="prefetch" href="/javacore/assets/js/66.42477259.js"><link rel="prefetch" href="/javacore/assets/js/7.a10910a7.js"><link rel="prefetch" href="/javacore/assets/js/8.04e2e190.js"><link rel="prefetch" href="/javacore/assets/js/9.cccc2c89.js"><link rel="prefetch" href="/javacore/assets/js/vendors~flowchart.d81c2c68.js"><link rel="prefetch" href="/javacore/assets/js/vendors~notification.4573acaf.js">
    <link rel="stylesheet" href="/javacore/assets/css/0.styles.f91e4221.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/javacore/" class="home-link router-link-active"><img src="images/dunwu-logo-100.png" alt="JAVACORE" class="logo"> <span class="site-name can-hide">JAVACORE</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/javacore/basics/" class="nav-link">
  åŸºç¡€
</a></div><div class="nav-item"><a href="/javacore/advanced/" class="nav-link">
  é«˜çº§
</a></div><div class="nav-item"><a href="/javacore/container/" class="nav-link">
  å®¹å™¨
</a></div><div class="nav-item"><a href="/javacore/io/" class="nav-link">
  IO
</a></div><div class="nav-item"><a href="/javacore/concurrent/" class="nav-link router-link-active">
  å¹¶å‘
</a></div><div class="nav-item"><a href="/javacore/jvm/" class="nav-link">
  JVM
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaTech æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ¯ åšå®¢
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/dunwu/javacore" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/javacore/basics/" class="nav-link">
  åŸºç¡€
</a></div><div class="nav-item"><a href="/javacore/advanced/" class="nav-link">
  é«˜çº§
</a></div><div class="nav-item"><a href="/javacore/container/" class="nav-link">
  å®¹å™¨
</a></div><div class="nav-item"><a href="/javacore/io/" class="nav-link">
  IO
</a></div><div class="nav-item"><a href="/javacore/concurrent/" class="nav-link router-link-active">
  å¹¶å‘
</a></div><div class="nav-item"><a href="/javacore/jvm/" class="nav-link">
  JVM
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaTech æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ¯ åšå®¢
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/dunwu/javacore" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Java åŸå­å˜é‡ç±»</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/javacore/concurrent/java-atomic-class.html#_1-åŸå­å˜é‡ç±»ç®€ä»‹" class="sidebar-link">1. åŸå­å˜é‡ç±»ç®€ä»‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javacore/concurrent/java-atomic-class.html#_1-1-ä¸ºä½•éœ€è¦åŸå­å˜é‡ç±»" class="sidebar-link">1.1. ä¸ºä½•éœ€è¦åŸå­å˜é‡ç±»</a></li><li class="sidebar-sub-header"><a href="/javacore/concurrent/java-atomic-class.html#_1-2-åŸå­å˜é‡ç±»çš„ä½œç”¨" class="sidebar-link">1.2. åŸå­å˜é‡ç±»çš„ä½œç”¨</a></li></ul></li><li><a href="/javacore/concurrent/java-atomic-class.html#_2-åŸºæœ¬ç±»å‹" class="sidebar-link">2. åŸºæœ¬ç±»å‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javacore/concurrent/java-atomic-class.html#atomicinteger-ç”¨æ³•" class="sidebar-link">`AtomicInteger` ç”¨æ³•</a></li><li class="sidebar-sub-header"><a href="/javacore/concurrent/java-atomic-class.html#atomicinteger-å®ç°" class="sidebar-link">`AtomicInteger` å®ç°</a></li></ul></li><li><a href="/javacore/concurrent/java-atomic-class.html#_3-å¼•ç”¨ç±»å‹" class="sidebar-link">3. å¼•ç”¨ç±»å‹</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/javacore/concurrent/java-atomic-class.html#_4-æ•°ç»„ç±»å‹" class="sidebar-link">4. æ•°ç»„ç±»å‹</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/javacore/concurrent/java-atomic-class.html#_5-å±æ€§æ›´æ–°å™¨ç±»å‹" class="sidebar-link">5. å±æ€§æ›´æ–°å™¨ç±»å‹</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/javacore/concurrent/java-atomic-class.html#_6-åŸå­åŒ–çš„ç´¯åŠ å™¨" class="sidebar-link">6. åŸå­åŒ–çš„ç´¯åŠ å™¨</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/javacore/concurrent/java-atomic-class.html#_7-å‚è€ƒèµ„æ–™" class="sidebar-link">7. å‚è€ƒèµ„æ–™</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="java-åŸå­å˜é‡ç±»"><a href="#java-åŸå­å˜é‡ç±»" class="header-anchor">#</a> Java åŸå­å˜é‡ç±»</h1> <blockquote><p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a href="https://github.com/dunwu/javacore/" target="_blank" rel="noopener noreferrer">javacore<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong></p></blockquote> <ul><li><a href="#1-%E5%8E%9F%E5%AD%90%E5%8F%98%E9%87%8F%E7%B1%BB%E7%AE%80%E4%BB%8B">1. åŸå­å˜é‡ç±»ç®€ä»‹</a> <ul><li><a href="#11-%E4%B8%BA%E4%BD%95%E9%9C%80%E8%A6%81%E5%8E%9F%E5%AD%90%E5%8F%98%E9%87%8F%E7%B1%BB">1.1. ä¸ºä½•éœ€è¦åŸå­å˜é‡ç±»</a></li> <li><a href="#12-%E5%8E%9F%E5%AD%90%E5%8F%98%E9%87%8F%E7%B1%BB%E7%9A%84%E4%BD%9C%E7%94%A8">1.2. åŸå­å˜é‡ç±»çš„ä½œç”¨</a></li></ul></li> <li><a href="#2-%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B">2. åŸºæœ¬ç±»å‹</a></li> <li><a href="#3-%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B">3. å¼•ç”¨ç±»å‹</a></li> <li><a href="#4-%E6%95%B0%E7%BB%84%E7%B1%BB%E5%9E%8B">4. æ•°ç»„ç±»å‹</a></li> <li><a href="#5-%E5%B1%9E%E6%80%A7%E6%9B%B4%E6%96%B0%E5%99%A8%E7%B1%BB%E5%9E%8B">5. å±æ€§æ›´æ–°å™¨ç±»å‹</a></li> <li><a href="#6-%E5%8E%9F%E5%AD%90%E5%8C%96%E7%9A%84%E7%B4%AF%E5%8A%A0%E5%99%A8">6. åŸå­åŒ–çš„ç´¯åŠ å™¨</a></li> <li><a href="#7-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">7. å‚è€ƒèµ„æ–™</a></li></ul> <h2 id="_1-åŸå­å˜é‡ç±»ç®€ä»‹"><a href="#_1-åŸå­å˜é‡ç±»ç®€ä»‹" class="header-anchor">#</a> 1. åŸå­å˜é‡ç±»ç®€ä»‹</h2> <h3 id="_1-1-ä¸ºä½•éœ€è¦åŸå­å˜é‡ç±»"><a href="#_1-1-ä¸ºä½•éœ€è¦åŸå­å˜é‡ç±»" class="header-anchor">#</a> 1.1. ä¸ºä½•éœ€è¦åŸå­å˜é‡ç±»</h3> <p>ä¿è¯çº¿ç¨‹å®‰å…¨æ˜¯ Java å¹¶å‘ç¼–ç¨‹å¿…é¡»è¦è§£å†³çš„é‡è¦é—®é¢˜ã€‚Java ä»åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§è¿™ä¸‰å¤§ç‰¹æ€§å…¥æ‰‹ï¼Œç¡®ä¿å¤šçº¿ç¨‹çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p> <ul><li>ç¡®ä¿çº¿ç¨‹å®‰å…¨æœ€å¸¸è§çš„åšæ³•æ˜¯åˆ©ç”¨é”æœºåˆ¶ï¼ˆ<code>Lock</code>ã€<code>sychronized</code>ï¼‰æ¥å¯¹å…±äº«æ•°æ®åšäº’æ–¥åŒæ­¥ï¼Œè¿™æ ·åœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡ŒæŸä¸ªæ–¹æ³•æˆ–è€…æŸä¸ªä»£ç å—ï¼Œé‚£ä¹ˆæ“ä½œå¿…ç„¶æ˜¯åŸå­æ€§çš„ï¼Œçº¿ç¨‹å®‰å…¨çš„ã€‚äº’æ–¥åŒæ­¥æœ€ä¸»è¦çš„é—®é¢˜æ˜¯çº¿ç¨‹é˜»å¡å’Œå”¤é†’æ‰€å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ã€‚</li> <li><code>volatile</code> æ˜¯è½»é‡çº§çš„é”ï¼ˆè‡ªç„¶æ¯”æ™®é€šé”æ€§èƒ½è¦å¥½ï¼‰ï¼Œå®ƒä¿è¯äº†å…±äº«å˜é‡åœ¨å¤šçº¿ç¨‹ä¸­çš„å¯è§æ€§ï¼Œä½†æ— æ³•ä¿è¯åŸå­æ€§ã€‚æ‰€ä»¥ï¼Œå®ƒåªèƒ½åœ¨ä¸€äº›ç‰¹å®šåœºæ™¯ä¸‹ä½¿ç”¨ã€‚</li> <li>ä¸ºäº†å…¼é¡¾åŸå­æ€§ä»¥åŠé”å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼ŒJava å¼•å…¥äº† CAS ï¼ˆä¸»è¦ä½“ç°åœ¨ <code>Unsafe</code> ç±»ï¼‰æ¥å®ç°éé˜»å¡åŒæ­¥ï¼ˆä¹Ÿå«ä¹è§‚é”ï¼‰ã€‚å¹¶åŸºäº CAS ï¼Œæä¾›äº†ä¸€å¥—åŸå­å·¥å…·ç±»ã€‚</li></ul> <h3 id="_1-2-åŸå­å˜é‡ç±»çš„ä½œç”¨"><a href="#_1-2-åŸå­å˜é‡ç±»çš„ä½œç”¨" class="header-anchor">#</a> 1.2. åŸå­å˜é‡ç±»çš„ä½œç”¨</h3> <p>åŸå­å˜é‡ç±» <strong>æ¯”é”çš„ç²’åº¦æ›´ç»†ï¼Œæ›´è½»é‡çº§</strong>ï¼Œå¹¶ä¸”å¯¹äºåœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šå®ç°é«˜æ€§èƒ½çš„å¹¶å‘ä»£ç æ¥è¯´æ˜¯éå¸¸å…³é”®çš„ã€‚åŸå­å˜é‡å°†å‘ç”Ÿç«äº‰çš„èŒƒå›´ç¼©å°åˆ°å•ä¸ªå˜é‡ä¸Šã€‚</p> <p>åŸå­å˜é‡ç±»ç›¸å½“äºä¸€ç§æ³›åŒ–çš„ <code>volatile</code> å˜é‡ï¼Œèƒ½å¤Ÿ<strong>æ”¯æŒåŸå­çš„ã€æœ‰æ¡ä»¶çš„è¯»/æ”¹/å†™æ“</strong>ä½œã€‚</p> <p>åŸå­ç±»åœ¨å†…éƒ¨ä½¿ç”¨ CAS æŒ‡ä»¤ï¼ˆåŸºäºç¡¬ä»¶çš„æ”¯æŒï¼‰æ¥å®ç°åŒæ­¥ã€‚è¿™äº›æŒ‡ä»¤é€šå¸¸æ¯”é”æ›´å¿«ã€‚</p> <p>åŸå­å˜é‡ç±»å¯ä»¥åˆ†ä¸º 4 ç»„ï¼š</p> <ul><li>åŸºæœ¬ç±»å‹
<ul><li><code>AtomicBoolean</code> - å¸ƒå°”ç±»å‹åŸå­ç±»</li> <li><code>AtomicInteger</code> - æ•´å‹åŸå­ç±»</li> <li><code>AtomicLong</code> - é•¿æ•´å‹åŸå­ç±»</li></ul></li> <li>å¼•ç”¨ç±»å‹
<ul><li><code>AtomicReference</code> - å¼•ç”¨ç±»å‹åŸå­ç±»</li> <li><code>AtomicMarkableReference</code> - å¸¦æœ‰æ ‡è®°ä½çš„å¼•ç”¨ç±»å‹åŸå­ç±»</li> <li><code>AtomicStampedReference</code> - å¸¦æœ‰ç‰ˆæœ¬å·çš„å¼•ç”¨ç±»å‹åŸå­ç±»</li></ul></li> <li>æ•°ç»„ç±»å‹
<ul><li><code>AtomicIntegerArray</code> - æ•´å½¢æ•°ç»„åŸå­ç±»</li> <li><code>AtomicLongArray</code> - é•¿æ•´å‹æ•°ç»„åŸå­ç±»</li> <li><code>AtomicReferenceArray</code> - å¼•ç”¨ç±»å‹æ•°ç»„åŸå­ç±»</li></ul></li> <li>å±æ€§æ›´æ–°å™¨ç±»å‹
<ul><li><code>AtomicIntegerFieldUpdater</code> - æ•´å‹å­—æ®µçš„åŸå­æ›´æ–°å™¨ã€‚</li> <li><code>AtomicLongFieldUpdater</code> - é•¿æ•´å‹å­—æ®µçš„åŸå­æ›´æ–°å™¨ã€‚</li> <li><code>AtomicReferenceFieldUpdater</code> - åŸå­æ›´æ–°å¼•ç”¨ç±»å‹é‡Œçš„å­—æ®µã€‚</li></ul></li></ul> <blockquote><p>è¿™é‡Œä¸å¯¹ CASã€volatileã€äº’æ–¥åŒæ­¥åšæ·±å…¥æ¢è®¨ã€‚å¦‚æœæƒ³äº†è§£æ›´å¤šç»†èŠ‚ï¼Œä¸å¦¨å‚è€ƒï¼š<a href="https://github.com/dunwu/javacore/blob/master/docs/concurrent/java-concurrent-basic-mechanism.md" target="_blank" rel="noopener noreferrer">Java å¹¶å‘æ ¸å¿ƒæœºåˆ¶<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="_2-åŸºæœ¬ç±»å‹"><a href="#_2-åŸºæœ¬ç±»å‹" class="header-anchor">#</a> 2. åŸºæœ¬ç±»å‹</h2> <p>è¿™ä¸€ç±»å‹çš„åŸå­ç±»æ˜¯é’ˆå¯¹ Java åŸºæœ¬ç±»å‹è¿›è¡Œæ“ä½œã€‚</p> <ul><li><code>AtomicBoolean</code> - å¸ƒå°”ç±»å‹åŸå­ç±»</li> <li><code>AtomicInteger</code> - æ•´å‹åŸå­ç±»</li> <li><code>AtomicLong</code> - é•¿æ•´å‹åŸå­ç±»</li></ul> <p>ä»¥ä¸Šç±»éƒ½æ”¯æŒ CASï¼ˆ<a href="https://en.wikipedia.org/wiki/Compare-and-swap" target="_blank" rel="noopener noreferrer">compare-and-swap<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼‰æŠ€æœ¯ï¼Œæ­¤å¤–ï¼Œ<code>AtomicInteger</code>ã€<code>AtomicLong</code> è¿˜æ”¯æŒç®—æœ¯è¿ç®—ã€‚</p> <blockquote><p>ğŸ’¡ æç¤ºï¼š</p> <p>è™½ç„¶ Java åªæä¾›äº† <code>AtomicBoolean</code> ã€<code>AtomicInteger</code>ã€<code>AtomicLong</code>ï¼Œä½†æ˜¯å¯ä»¥æ¨¡æ‹Ÿå…¶ä»–åŸºæœ¬ç±»å‹çš„åŸå­å˜é‡ã€‚è¦æƒ³æ¨¡æ‹Ÿå…¶ä»–åŸºæœ¬ç±»å‹çš„åŸå­å˜é‡ï¼Œå¯ä»¥å°† <code>short</code> æˆ– <code>byte</code> ç­‰ç±»å‹ä¸ <code>int</code> ç±»å‹è¿›è¡Œè½¬æ¢ï¼Œä»¥åŠä½¿ç”¨ <code>Float.floatToIntBits</code> ã€<code>Double.doubleToLongBits</code> æ¥è½¬æ¢æµ®ç‚¹æ•°ã€‚</p> <p>ç”±äº <code>AtomicBoolean</code>ã€<code>AtomicInteger</code>ã€<code>AtomicLong</code> å®ç°æ–¹å¼ã€ä½¿ç”¨æ–¹å¼éƒ½ç›¸è¿‘ï¼Œæ‰€ä»¥æœ¬æ–‡ä»…é’ˆå¯¹ <code>AtomicInteger</code> è¿›è¡Œä»‹ç»ã€‚</p></blockquote> <h3 id="atomicinteger-ç”¨æ³•"><a href="#atomicinteger-ç”¨æ³•" class="header-anchor">#</a> <strong><code>AtomicInteger</code> ç”¨æ³•</strong></h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è·å–å½“å‰å€¼</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndSet</span><span class="token punctuation">(</span><span class="token keyword">int</span> newValue<span class="token punctuation">)</span> <span class="token comment">// è·å–å½“å‰å€¼ï¼Œå¹¶è®¾ç½®æ–°å€¼</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// è·å–å½“å‰å€¼ï¼Œå¹¶è‡ªå¢</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndDecrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è·å–å½“å‰å€¼ï¼Œå¹¶è‡ªå‡</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndAdd</span><span class="token punctuation">(</span><span class="token keyword">int</span> delta<span class="token punctuation">)</span> <span class="token comment">// è·å–å½“å‰å€¼ï¼Œå¹¶åŠ ä¸Šé¢„æœŸå€¼</span>
<span class="token keyword">boolean</span> <span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token keyword">int</span> expect<span class="token punctuation">,</span> <span class="token keyword">int</span> update<span class="token punctuation">)</span> <span class="token comment">// å¦‚æœè¾“å…¥å€¼ï¼ˆupdateï¼‰ç­‰äºé¢„æœŸå€¼ï¼Œå°†è¯¥å€¼è®¾ç½®ä¸ºè¾“å…¥å€¼</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">lazySet</span><span class="token punctuation">(</span><span class="token keyword">int</span> newValue<span class="token punctuation">)</span> <span class="token comment">// æœ€ç»ˆè®¾ç½®ä¸º newValueï¼Œä½¿ç”¨ lazySet è®¾ç½®ä¹‹åå¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹åœ¨ä¹‹åçš„ä¸€å°æ®µæ—¶é—´å†…è¿˜æ˜¯å¯ä»¥è¯»åˆ°æ—§çš„å€¼ã€‚</span>
</code></pre></div><p><code>AtomicInteger</code> ä½¿ç”¨ç¤ºä¾‹ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicIntegerDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AtomicInteger</span> count <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; count=&quot;</span> <span class="token operator">+</span> count<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                count<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executorService<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Final Count is : &quot;</span> <span class="token operator">+</span> count<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="atomicinteger-å®ç°"><a href="#atomicinteger-å®ç°" class="header-anchor">#</a> <strong><code>AtomicInteger</code> å®ç°</strong></h3> <p>é˜…è¯» <code>AtomicInteger</code> æºç ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹å®šä¹‰ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Unsafe</span> unsafe <span class="token operator">=</span> <span class="token class-name">Unsafe</span><span class="token punctuation">.</span><span class="token function">getUnsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> valueOffset<span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token punctuation">{</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		valueOffset <span class="token operator">=</span> unsafe<span class="token punctuation">.</span>objectFieldOffset
			<span class="token punctuation">(</span><span class="token class-name">AtomicInteger</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> value<span class="token punctuation">;</span>
</code></pre></div><blockquote><p>è¯´æ˜ï¼š</p> <ul><li><code>value</code> - value å±æ€§ä½¿ç”¨ <code>volatile</code> ä¿®é¥°ï¼Œä½¿å¾—å¯¹ value çš„ä¿®æ”¹åœ¨å¹¶å‘ç¯å¢ƒä¸‹å¯¹æ‰€æœ‰çº¿ç¨‹å¯è§ã€‚</li> <li><code>valueOffset</code> - value å±æ€§çš„åç§»é‡ï¼Œé€šè¿‡è¿™ä¸ªåç§»é‡å¯ä»¥å¿«é€Ÿå®šä½åˆ° value å­—æ®µï¼Œè¿™ä¸ªæ˜¯å®ç° AtomicInteger çš„å…³é”®ã€‚</li> <li><code>unsafe</code> - Unsafe ç±»å‹çš„å±æ€§ï¼Œå®ƒä¸º <code>AtomicInteger</code> æä¾›äº† CAS æ“ä½œã€‚</li></ul></blockquote> <h2 id="_3-å¼•ç”¨ç±»å‹"><a href="#_3-å¼•ç”¨ç±»å‹" class="header-anchor">#</a> 3. å¼•ç”¨ç±»å‹</h2> <p>Java æ•°æ®ç±»å‹åˆ†ä¸º <strong>åŸºæœ¬æ•°æ®ç±»å‹</strong> å’Œ <strong>å¼•ç”¨æ•°æ®ç±»å‹</strong> ä¸¤å¤§ç±»ï¼ˆä¸äº†è§£ Java æ•°æ®ç±»å‹åˆ’åˆ†å¯ä»¥å‚è€ƒï¼š <a href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-data-type.md" target="_blank" rel="noopener noreferrer">Java åŸºæœ¬æ•°æ®ç±»å‹<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ï¼‰ã€‚</p> <p>ä¸Šä¸€èŠ‚ä¸­æåˆ°äº†é’ˆå¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„åŸå­ç±»ï¼Œé‚£ä¹ˆå¦‚æœæƒ³é’ˆå¯¹å¼•ç”¨ç±»å‹åšåŸå­æ“ä½œæ€ä¹ˆåŠï¼ŸJava ä¹Ÿæä¾›äº†ç›¸å…³çš„åŸå­ç±»ï¼š</p> <ul><li><code>AtomicReference</code> - å¼•ç”¨ç±»å‹åŸå­ç±»</li> <li><code>AtomicMarkableReference</code> - å¸¦æœ‰æ ‡è®°ä½çš„å¼•ç”¨ç±»å‹åŸå­ç±»</li> <li><code>AtomicStampedReference</code> - å¸¦æœ‰ç‰ˆæœ¬å·çš„å¼•ç”¨ç±»å‹åŸå­ç±»</li></ul> <blockquote><p><code>AtomicStampedReference</code> ç±»åœ¨å¼•ç”¨ç±»å‹åŸå­ç±»ä¸­ï¼Œå½»åº•åœ°è§£å†³äº† ABA é—®é¢˜ï¼Œå…¶å®ƒçš„ CAS èƒ½åŠ›ä¸å¦å¤–ä¸¤ä¸ªç±»ç›¸è¿‘ï¼Œæ‰€ä»¥æœ€å…·ä»£è¡¨æ€§ã€‚å› æ­¤ï¼Œæœ¬èŠ‚åªé’ˆå¯¹ <code>AtomicStampedReference</code> è¿›è¡Œè¯´æ˜ã€‚</p></blockquote> <p>ç¤ºä¾‹ï¼šåŸºäº <code>AtomicReference</code> å®ç°ä¸€ä¸ªç®€å•çš„è‡ªæ—‹é”</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicReferenceDemo2</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> ticket <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">threadSafeDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">threadSafeDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpinLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpinLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * åŸºäº {@link AtomicReference} å®ç°çš„ç®€å•è‡ªæ—‹é”
     */</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SpinLock</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">&gt;</span></span> atomicReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> current <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>atomicReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> current<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> current <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            atomicReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * åˆ©ç”¨è‡ªæ—‹é” {@link SpinLock} å¹¶å‘å¤„ç†æ•°æ®
     */</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token class-name">SpinLock</span> lock<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token class-name">SpinLock</span> lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>lock <span class="token operator">=</span> lock<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>ticket <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ticket <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; å–å‡ºäº†ç¬¬ &quot;</span> <span class="token operator">+</span> ticket <span class="token operator">+</span> <span class="token string">&quot; å¼ ç¥¨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ticket<span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>åŸå­ç±»çš„å®ç°åŸºäº CAS æœºåˆ¶ï¼Œè€Œ CAS å­˜åœ¨ ABA é—®é¢˜ï¼ˆä¸äº†è§£ ABA é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒï¼š<a href="https://github.com/dunwu/javacore/blob/master/docs/concurrent/java-concurrent-basic-mechanism.md#cas-%E7%9A%84%E9%97%AE%E9%A2%98" target="_blank" rel="noopener noreferrer">Java å¹¶å‘åŸºç¡€æœºåˆ¶ - CAS çš„é—®é¢˜<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼‰ã€‚æ­£æ˜¯ä¸ºäº†è§£å†³ ABA é—®é¢˜ï¼Œæ‰æœ‰äº† <code>AtomicMarkableReference</code> å’Œ <code>AtomicStampedReference</code>ã€‚</p> <p><code>AtomicMarkableReference</code> ä½¿ç”¨ä¸€ä¸ªå¸ƒå°”å€¼ä½œä¸ºæ ‡è®°ï¼Œä¿®æ”¹æ—¶åœ¨ true / false ä¹‹é—´åˆ‡æ¢ã€‚è¿™ç§ç­–ç•¥ä¸èƒ½æ ¹æœ¬ä¸Šè§£å†³ ABA é—®é¢˜ï¼Œä½†æ˜¯å¯ä»¥é™ä½ ABA å‘ç”Ÿçš„å‡ ç‡ã€‚å¸¸ç”¨äºç¼“å­˜æˆ–è€…çŠ¶æ€æè¿°è¿™æ ·çš„åœºæ™¯ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicMarkableReferenceDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> INIT_TEXT <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

        <span class="token keyword">final</span> <span class="token class-name">AtomicMarkableReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> amr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicMarkableReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>INIT_TEXT<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>amr<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>INIT_TEXT<span class="token punctuation">,</span> name<span class="token punctuation">,</span> amr<span class="token punctuation">.</span><span class="token function">isMarked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">!</span>amr<span class="token punctuation">.</span><span class="token function">isMarked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; ä¿®æ”¹äº†å¯¹è±¡ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ–°çš„å¯¹è±¡ä¸ºï¼š&quot;</span> <span class="token operator">+</span> amr<span class="token punctuation">.</span><span class="token function">getReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executorService<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p><strong><code>AtomicStampedReference</code> ä½¿ç”¨ä¸€ä¸ªæ•´å‹å€¼åšä¸ºç‰ˆæœ¬å·ï¼Œæ¯æ¬¡æ›´æ–°å‰å…ˆæ¯”è¾ƒç‰ˆæœ¬å·ï¼Œå¦‚æœä¸€è‡´ï¼Œæ‰è¿›è¡Œä¿®æ”¹</strong>ã€‚é€šè¿‡è¿™ç§ç­–ç•¥ï¼Œå¯ä»¥æ ¹æœ¬ä¸Šè§£å†³ ABA é—®é¢˜ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicStampedReferenceDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> INIT_REF <span class="token operator">=</span> <span class="token string">&quot;pool-1-thread-3&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">AtomicStampedReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> asr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicStampedReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>INIT_REF<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;åˆå§‹å¯¹è±¡ä¸ºï¼š&quot;</span> <span class="token operator">+</span> asr<span class="token punctuation">.</span><span class="token function">getReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executorService<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">final</span> <span class="token keyword">int</span> stamp <span class="token operator">=</span> asr<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>asr<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>INIT_REF<span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stamp<span class="token punctuation">,</span> stamp <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; ä¿®æ”¹äº†å¯¹è±¡ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ–°çš„å¯¹è±¡ä¸ºï¼š&quot;</span> <span class="token operator">+</span> asr<span class="token punctuation">.</span><span class="token function">getReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="_4-æ•°ç»„ç±»å‹"><a href="#_4-æ•°ç»„ç±»å‹" class="header-anchor">#</a> 4. æ•°ç»„ç±»å‹</h2> <p>Java æä¾›äº†ä»¥ä¸‹é’ˆå¯¹æ•°ç»„çš„åŸå­ç±»ï¼š</p> <ul><li><code>AtomicIntegerArray</code> - æ•´å½¢æ•°ç»„åŸå­ç±»</li> <li><code>AtomicLongArray</code> - é•¿æ•´å‹æ•°ç»„åŸå­ç±»</li> <li><code>AtomicReferenceArray</code> - å¼•ç”¨ç±»å‹æ•°ç»„åŸå­ç±»</li></ul> <p>å·²ç»æœ‰äº†é’ˆå¯¹åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„åŸå­ç±»ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æä¾›é’ˆå¯¹æ•°ç»„çš„åŸå­ç±»å‘¢ï¼Ÿ</p> <p>æ•°ç»„ç±»å‹çš„åŸå­ç±»ä¸º <strong>æ•°ç»„å…ƒç´ </strong> æä¾›äº† <code>volatile</code> ç±»å‹çš„è®¿é—®è¯­ä¹‰ï¼Œè¿™æ˜¯æ™®é€šæ•°ç»„æ‰€ä¸å…·å¤‡çš„ç‰¹æ€§â€”â€”<strong><code>volatile</code> ç±»å‹çš„æ•°ç»„ä»…åœ¨æ•°ç»„å¼•ç”¨ä¸Šå…·æœ‰ <code>volatile</code> è¯­ä¹‰</strong>ã€‚</p> <p>ç¤ºä¾‹ï¼š<code>AtomicIntegerArray</code> ä½¿ç”¨ç¤ºä¾‹ï¼ˆ<code>AtomicLongArray</code> ã€<code>AtomicReferenceArray</code> ä½¿ç”¨æ–¹å¼ä¹Ÿç±»ä¼¼ï¼‰</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicIntegerArrayDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">AtomicIntegerArray</span> atomicIntegerArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicIntegerArray</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arguments<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Init Values: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> atomicIntegerArray<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            atomicIntegerArray<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>atomicIntegerArray<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Compare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Final Values: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> atomicIntegerArray<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>atomicIntegerArray<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Increment</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> atomicIntegerArray<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">int</span> value <span class="token operator">=</span> atomicIntegerArray<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, index = &quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot;, value = &quot;</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Compare</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> atomicIntegerArray<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">boolean</span> swapped <span class="token operator">=</span> atomicIntegerArray<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>swapped<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; swapped, index = &quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot;, value = 3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="_5-å±æ€§æ›´æ–°å™¨ç±»å‹"><a href="#_5-å±æ€§æ›´æ–°å™¨ç±»å‹" class="header-anchor">#</a> 5. å±æ€§æ›´æ–°å™¨ç±»å‹</h2> <p>æ›´æ–°å™¨ç±»æ”¯æŒåŸºäºåå°„æœºåˆ¶çš„æ›´æ–°å­—æ®µå€¼çš„åŸå­æ“ä½œã€‚</p> <ul><li><code>AtomicIntegerFieldUpdater</code> - æ•´å‹å­—æ®µçš„åŸå­æ›´æ–°å™¨ã€‚</li> <li><code>AtomicLongFieldUpdater</code> - é•¿æ•´å‹å­—æ®µçš„åŸå­æ›´æ–°å™¨ã€‚</li> <li><code>AtomicReferenceFieldUpdater</code> - åŸå­æ›´æ–°å¼•ç”¨ç±»å‹é‡Œçš„å­—æ®µã€‚</li></ul> <p>è¿™äº›ç±»çš„ä½¿ç”¨æœ‰ä¸€å®šé™åˆ¶ï¼š</p> <ul><li>å› ä¸ºå¯¹è±¡çš„å±æ€§ä¿®æ”¹ç±»å‹åŸå­ç±»éƒ½æ˜¯æŠ½è±¡ç±»ï¼Œæ‰€ä»¥æ¯æ¬¡ä½¿ç”¨éƒ½å¿…é¡»ä½¿ç”¨é™æ€æ–¹æ³• <code>newUpdater()</code> åˆ›å»ºä¸€ä¸ªæ›´æ–°å™¨ï¼Œå¹¶ä¸”éœ€è¦è®¾ç½®æƒ³è¦æ›´æ–°çš„ç±»å’Œå±æ€§ã€‚</li> <li>å­—æ®µå¿…é¡»æ˜¯ <code>volatile</code> ç±»å‹çš„ï¼›</li> <li>ä¸èƒ½ä½œç”¨äºé™æ€å˜é‡ï¼ˆ<code>static</code>ï¼‰ï¼›</li> <li>ä¸èƒ½ä½œç”¨äºå¸¸é‡ï¼ˆ<code>final</code>ï¼‰ï¼›</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicReferenceFieldUpdaterDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;begin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token class-name">AtomicReferenceFieldUpdater</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> updater <span class="token operator">=</span>
        <span class="token class-name">AtomicReferenceFieldUpdater</span><span class="token punctuation">.</span><span class="token function">newUpdater</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>updater<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token string">&quot;begin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; å·²ä¿®æ”¹ name = &quot;</span> <span class="token operator">+</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; å·²è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>

        <span class="token keyword">volatile</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="_6-åŸå­åŒ–çš„ç´¯åŠ å™¨"><a href="#_6-åŸå­åŒ–çš„ç´¯åŠ å™¨" class="header-anchor">#</a> 6. åŸå­åŒ–çš„ç´¯åŠ å™¨</h2> <p><code>DoubleAccumulator</code>ã€<code>DoubleAdder</code>ã€<code>LongAccumulator</code> å’Œ <code>LongAdder</code>ï¼Œè¿™å››ä¸ªç±»ä»…ä»…ç”¨æ¥æ‰§è¡Œç´¯åŠ æ“ä½œï¼Œç›¸æ¯”åŸå­åŒ–çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œä½†æ˜¯ä¸æ”¯æŒ <code>compareAndSet()</code> æ–¹æ³•ã€‚å¦‚æœä½ ä»…ä»…éœ€è¦ç´¯åŠ æ“ä½œï¼Œä½¿ç”¨åŸå­åŒ–çš„ç´¯åŠ å™¨æ€§èƒ½ä¼šæ›´å¥½ï¼Œä»£ä»·å°±æ˜¯ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ç©ºé—´ã€‚</p> <p><code>LongAdder</code> å†…éƒ¨ç”±ä¸€ä¸ª <code>base</code> å˜é‡å’Œä¸€ä¸ª <code>cell[]</code> æ•°ç»„ç»„æˆã€‚</p> <ul><li>å½“åªæœ‰ä¸€ä¸ªå†™çº¿ç¨‹ï¼Œæ²¡æœ‰ç«äº‰çš„æƒ…å†µä¸‹ï¼Œ<code>LongAdder</code> ä¼šç›´æ¥ä½¿ç”¨ <code>base</code> å˜é‡ä½œä¸ºåŸå­æ“ä½œå˜é‡ï¼Œé€šè¿‡ CAS æ“ä½œä¿®æ”¹å˜é‡ï¼›</li> <li>å½“æœ‰å¤šä¸ªå†™çº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹ï¼Œé™¤äº†å ç”¨ <code>base</code> å˜é‡çš„ä¸€ä¸ªå†™çº¿ç¨‹ä¹‹å¤–ï¼Œå…¶å®ƒå„ä¸ªçº¿ç¨‹ä¼šå°†ä¿®æ”¹çš„å˜é‡å†™å…¥åˆ°è‡ªå·±çš„æ§½ <code>cell[]</code> æ•°ç»„ä¸­ã€‚</li></ul> <p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ<code>LongAdder</code> åœ¨æ“ä½œåçš„è¿”å›å€¼åªæ˜¯ä¸€ä¸ªè¿‘ä¼¼å‡†ç¡®çš„æ•°å€¼ï¼Œä½†æ˜¯ <code>LongAdder</code> æœ€ç»ˆè¿”å›çš„æ˜¯ä¸€ä¸ªå‡†ç¡®çš„æ•°å€¼ï¼Œ æ‰€ä»¥åœ¨ä¸€äº›å¯¹å®æ—¶æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯ä¸‹ï¼Œ<code>LongAdder</code> å¹¶ä¸èƒ½å–ä»£ <code>AtomicInteger</code> æˆ– <code>AtomicLong</code>ã€‚</p> <h2 id="_7-å‚è€ƒèµ„æ–™"><a href="#_7-å‚è€ƒèµ„æ–™" class="header-anchor">#</a> 7. å‚è€ƒèµ„æ–™</h2> <ul><li><a href="https://item.jd.com/10922250.html" target="_blank" rel="noopener noreferrer">ã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://item.jd.com/11740734.html" target="_blank" rel="noopener noreferrer">ã€ŠJava å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.itsoku.com/article/182" target="_blank" rel="noopener noreferrer">JUC ä¸­çš„åŸå­ç±»<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>http://tutorials.jenkov.com/java-util-concurrent/atomicinteger.html</li> <li>http://tutorials.jenkov.com/java-util-concurrent/atomicintegerarray.html</li> <li>http://tutorials.jenkov.com/java-util-concurrent/atomicreference.html</li> <li>http://tutorials.jenkov.com/java-util-concurrent/atomicstampedreference.htm</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/javacore/edit/master/docs/concurrent/java-atomic-class.md" target="_blank" rel="noopener noreferrer">å¸®åŠ©æˆ‘ä»¬æ”¹å–„æ­¤é¡µé¢ï¼</a> <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/javacore/assets/js/app.2a3d1b81.js" defer></script><script src="/javacore/assets/js/4.c74b6b46.js" defer></script><script src="/javacore/assets/js/33.06f835e3.js" defer></script><script src="/javacore/assets/js/5.0833ef28.js" defer></script>
  </body>
</html>
